---
// src/pages/[subject]/index.astro
import Base from "../../layouts/Base.astro";
import { getCollection } from "astro:content";
import CourseGrid from "../../components/CourseGrid";
import Breadcrumbs from "../../components/Breadcrumbs.astro";

export async function getStaticPaths() {
  const subjects = await getCollection("subjects");
  return subjects.map((s) => ({
    params: { subject: s.data.slug },
  }));
}

const { subject } = Astro.params;

// находим сам предмет
const subjectEntry = (await getCollection("subjects")).find(
  (s) => s.data.slug === subject
);

if (!subjectEntry) {
  throw new Error(`Предмет не найден: ${subject}`);
}

const courses = (await getCollection("courses"))
  .filter((c) => c.data.subject === subject)
  .sort((a, b) => (a.data.order ?? 999) - (b.data.order ?? 999));
---

<Base title={subjectEntry.data.title}>
  <Breadcrumbs
    items={[
      { label: "Главная", href: "/" },
      { label: subjectEntry.data.title },
    ]}
  />

  <h1 class="mb-6 text-2xl font-semibold">
    {subjectEntry.data.emoji} {subjectEntry.data.title}
  </h1>

  <CourseGrid client:load subjectSlug={subject} courses={courses} />
</Base>
