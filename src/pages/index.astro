---
import '../styles/tailwind.css';
import { subjects } from '../data/catalog';
import SubjectGrid from '../components/SubjectGrid';

const all = subjects;
---
<html lang="ru">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ ‚Äî –ü—Ä–µ–¥–º–µ—Ç—ã</title>
  </head>
  <body class="bg-gray-50 text-gray-900 dark:bg-zinc-900 dark:text-zinc-50">
    <header class="sticky top-0 z-30 border-b bg-white/80 backdrop-blur dark:bg-zinc-900/70">
      <div class="mx-auto max-w-7xl px-4 py-3 flex items-center justify-between">
        <div class="flex items-center gap-2">
          <div class="h-8 w-8 rounded-2xl bg-emerald-500/15" />
          <span class="text-lg font-semibold">–•—É—Ç–±–∞</span>
        </div>
        <nav class="hidden sm:flex items-center gap-2 text-sm">
          <a href="/" class="rounded-lg px-3 py-1.5 hover:bg-gray-100 dark:hover:bg-white/10">–ì–ª–∞–≤–Ω–∞—è</a>
        </nav>
      </div>
    </header>

    <main class="mx-auto max-w-7xl px-4 py-6">
      <div class="mb-6 flex flex-col gap-3 sm:flex-row sm:items-end sm:justify-between">
        <div>
          <h1 class="text-3xl font-bold">–ü—Ä–µ–¥–º–µ—Ç—ã</h1>
          <p class="text-gray-600 dark:text-gray-300">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–µ–¥–º–µ—Ç, –∑–∞—Ç–µ–º –∫—É—Ä—Å (–ø–æ 3 –∫—É—Ä—Å–∞ –≤ –∫–∞–∂–¥–æ–º).</p>
        </div>

        <!-- –ü–æ–∏—Å–∫ –ø–æ –ø—Ä–µ–¥–º–µ—Ç–∞–º (–∫–ª–∏–µ–Ω—Ç—Å–∫–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è) -->
        <div class="relative">
          <input
            id="subjectSearch"
            placeholder="–ü–æ–∏—Å–∫ –ø–æ –ø—Ä–µ–¥–º–µ—Ç–∞–º"
            class="w-72 rounded-xl border bg-white/80 px-3 py-2 outline-none ring-emerald-600/30
                   focus:ring-2 dark:bg-white/10 dark:border-white/15"
          />
          <span class="pointer-events-none absolute right-3 top-1/2 -translate-y-1/2 text-gray-400">üîé</span>
        </div>
      </div>

      <div id="gridRoot">
        <SubjectGrid client:load items={subjects} />
      </div>
    </main>

    <script is:inline>
      const input = document.getElementById('subjectSearch');
      const root = document.getElementById('gridRoot');
      const items = {all: JSON.parse({all: JSON.stringify({all: undefined})})}; // placeholder to keep Vite happy
      // –ø—Ä–æ—Å—Ç–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ fetch –∫ —Ç–æ–π –∂–µ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –∏ –∑–∞–º–µ–Ω–∞ HTML ‚Äî –±–µ–∑ —Å–±–æ—Ä–∫–∏ –æ—Å—Ç—Ä–æ–≤–æ–≤
      input?.addEventListener('input', async (e) => {
        const q = (e.target?.value || '').toLowerCase();
        const res = await fetch(location.href);
        const html = await res.text();
        // –≥—Ä—É–±–æ ‚Äî –≤—ã—Ç–∞—Å–∫–∏–≤–∞–µ–º —Å–ø–∏—Å–æ–∫ –∏–∑ —Ç–µ–∫—É—â–µ–π —Ä–∞–∑–º–µ—Ç–∫–∏ –∏ —Ñ–∏–ª—å—Ç—Ä—É–µ–º –Ω–∞ –ª–µ—Ç—É
        const parser = new DOMParser();
        const doc = parser.parseFromString(html, 'text/html');
        const links = Array.from(doc.querySelectorAll('a[href$="/"] .truncate, a[href$="/"] h3')).map(el => el.textContent?.trim() || '');
        const cards = Array.from(document.querySelectorAll('#gridRoot > div > a'));
        cards.forEach((card, idx) => {
          const name = card.querySelector('h3')?.textContent?.trim().toLowerCase() || '';
          card.classList.toggle('hidden', !name.includes(q));
        });
      });
    </script>
  </body>
</html>
